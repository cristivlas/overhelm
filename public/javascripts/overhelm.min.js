var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,c,d){var b=this.length||0;0>c&&(c=Math.max(0,b+c));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(c=Number(c||0);c<d;c++)this[c]=a;return this}},"es6","es3");
var defaultZoom=12,locationTimeout=1E3,popup=null,app={setCourse:function(){this.setDestination(popup.getPosition())},cancelCourse:function(){this.setDestination(null)},hasDestination:function(){return this.map._destLocation},isDestination:function(a){return this.hasDestination()&&equalPoint(a,this.map._destLocation._point)},hideSearch:function(a){if(a.path)for(var b=0;b!=a.path.length;++b){if("search"===a.path[b].id)return}else if("search"===a.target.id)return;var c=document.getElementById("search-btns");
"visible"===c.style.visibility&&$(c).animate({left:"-100px"},{complete:function(){c.style.visibility="hidden"}})},map:null,tzOffset:6E4*(new Date).getTimezoneOffset(),powerClick:0,destination:{coord:null,place:null},tide:{station:null,chart:{line:null,lastUpdated:new Date,visible:!0},offset:0},clock:{visible:!0,positioned:0,lastUpdated:new Date}};
if(navigator.userAgent.match(/armv7/)||navigator.userAgent.match(/ipad/i)){var elem$0=document.getElementById("map");elem$0.className+=" tablet large-icon"}else{var elem$1=document.getElementById("map");elem$1.className+=" large-icon"}function isFullScreen(){return geolocation._mobile?!1:window.innerHeight>=screen.height}function equalPoint(a,b){return a?b?a[0]===b[0]&&a[1]===b[1]:!a:!b}
function updateTracking(a){var b=document.getElementById("tracking");b&&(b.style.background=a?"green":"brown")}
var trackingControl=function(a){a=a||{};var b=document.createElement("button"),c=document.createElement("img");c.src="images/location-arrow.png";c.className="ctrl-img";b.appendChild(c);b.title="Track current location";b.className="ctrl-btn";var d=document.createElement("img");d.src="images/navigation-arrow.png";d.className="ctrl-img";b.addEventListener("click",function(){if(!app.map.animation){app.map.animation=!0;geolocation.isTracking()?app.map.toggleRotation():geolocation.start();app.map._rotateView?
(c.parentElement===b&&b.removeChild(c),b.appendChild(d)):(d.parentElement===b&&b.removeChild(d),b.appendChild(c));var a=0,e=app.map._rotateView;app.map._rotateView&&(app.map._rotateView=!1,app.map._view.setRotation(0),a=2*Math.PI-geolocation.rotation);app.map._view.animate({center:app.map._currentLocation._point,zoom:defaultZoom,duration:2E3,rotation:a},function(){updateWaterLevel(app.map.showCurrentLocation(!0)._coord);e&&app.map.toggleRotation();app.map.animation=!1})}},!1);var e=document.createElement("div");
e.id="tracking";e.className="tracking ol-custom ol-unselectable ol-control";e.appendChild(b);ol.control.Control.call(this,{element:e,target:a.target})};ol.inherits(trackingControl,ol.control.Control);
var isSearching=!1,searchControl=function(a){var b={name:"ms-US English (Latin)",lang:["en"],normal:["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","q w e r t y u i o p [ ] \\","a s d f g h j k l ; '","{shift} \\ z x c v b n m , . / {shift}","{space}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","Q W E R T Y U I O P { } |",'A S D F G H J K L : "',"{shift} | Z X C V B N M < > / {shift}","{space}"]};a=a||{};var c=document.createElement("div");c.className=c.id="search-btns";c.style.visibility="hidden";document.body.appendChild(c);
var d=document.createElement("button");d.className="btn btn-primary custom-btn";d.innerHTML="Locations";d.id="search";d.title="Search U.S. and Canada coastal locations";d.addEventListener("click",function(a){if(!isSearching){alertify.prompt("",function(a,b){a&&(b=b.trim())&&searchLocation(b,app.map._location._coord)});var c=document.getElementById("alertify-form");"?touch"===location.search&&$("#alertify-text").keyboard({autoAccept:!0,layout:"custom",customLayout:b,usePreview:!1,visible:function(a,
b,d){a=document.getElementById("alertify-text_keyboard");c.appendChild(a)}})}});c.appendChild(d);c=document.createElement("button");d=document.createElement("img");d.src="images/magnifier.png";d.className="ctrl-img";c.appendChild(d);c.title="Search";c.className="ctrl-btn";c.id="search";c.addEventListener("click",function(){var a=document.getElementById("search-btns");if("hidden"===a.style.visibility){var b=document.getElementById("search").parentElement.getBoundingClientRect();a.style.top=Math.floor(b.top)+
"px";a.style.left="-100px";a.style.height=Math.floor(b.height)+"px";a.style.visibility="visible";$(a).animate({left:Math.ceil(b.right)+"px"},{complete:function(){}})}},!1);d=document.createElement("div");d.className="search ol-custom ol-unselectable ol-control";d.appendChild(c);ol.control.Control.call(this,{element:d,target:a.target})};ol.inherits(searchControl,ol.control.Control);
var destControl=function(a){a=a||{};var b=document.createElement("button"),c=document.createElement("img");c.src="images/circular-target.png";c.className="ctrl-img";b.appendChild(c);b.title="Zoom on location";b.className="ctrl-btn";c=function(){popup.visible&&$(popup.getElement()).popover("destroy");popup.visible=popup.show=!1;if(app.hasDestination()){geolocation.stop();var a=app.map.showDestination();updatePopup(a._point,app.destination.place,a._coord)}else if(!app.map.animation){app.map.animation=
!0;a=0;var b=app.map._rotateView;app.map._rotateView&&(app.map._rotateView=!1,app.map._view.setRotation(0),a=2*Math.PI-geolocation.rotation);app.map._view.animate({center:app.map._location._point,zoom:16,duration:2E3,rotation:a},function(){var a=app.map._location;popup.place&&equalPoint(popup.coord,a._coord)&&updatePopup(a._point,popup.place,a._coord);b&&app.map.toggleRotation();app.map.animation=!1})}};b.addEventListener("click",c,!1);b.addEventListener("touchstart",c,!1);c=document.createElement("div");
c.id="dest";c.className="dest ol-custom ol-unselectable ol-control";c.appendChild(b);ol.control.Control.call(this,{element:c,target:a.target})};ol.inherits(destControl,ol.control.Control);
var shutdownControl=function(a){a=a||{};var b=document.createElement("button"),c=document.createElement("img");c.src="images/shutdown.png";c.className="ctrl-img";b.appendChild(c);b.title="Shutdown system";b.className="ctrl-btn";var d=function(){alertify.confirm("Do you really want to <b>shutdown</b> the system?",function(a){a&&(a=new XMLHttpRequest,a.open("GET","/shutdown/now"),a.send())})},e=function(){alertify.confirm("Do you really want to <b>reboot</b> the system?",function(a){a&&(a=new XMLHttpRequest,
a.open("GET","/shutdown/reboot"),a.send())})};b.addEventListener("click",function(){0===app.powerClick&&setTimeout(function(){1<app.powerClick?e():d();app.powerClick=0},250);++app.powerClick},!1);c=document.createElement("div");c.className="shutdown ol-custom ol-unselectable ol-control";c.appendChild(b);c.id="shutdown";ol.control.Control.call(this,{element:c,target:a.target})};ol.inherits(shutdownControl,ol.control.Control);
var tideChartControl=function(a){a=a||{};var b=document.createElement("canvas");b.id="tideChart";var c=document.createElement("div");c.className="tide-chart ol-unselectable ol-control";c.appendChild(b);ol.control.Control.call(this,{element:c,target:a.target})};ol.inherits(tideChartControl,ol.control.Control);
function newOpenCloseWidget(a,b,c,d,e){var k=document.createElement("button"),m=document.createElement("img"),n=document.createElement("img");m.src="images/right-arrow.png";n.src="images/left-arrow.png";k.appendChild(m);k.title=a;k.id=d;var f=function(){var d=document.getElementById(c).parentElement;e?(d.style.visibility="hidden",k.title=b,k.appendChild(n),m.parentElement===k&&k.removeChild(m)):(d.style.visibility="visible",k.title=a,k.appendChild(m),n.parentElement===k&&k.removeChild(n));e^=1};k.addEventListener("click",
f,!1);var g=document.createElement("div");g.className=d+" ol-custom ol-unselectable ol-control";g.appendChild(k);app["hide_"+c]=function(){e=!0;f()};return g}var showTideControl=function(a){a=a||{};var b=newOpenCloseWidget("Hide tide info","Show tide info","tideChart","show-tide",app.tide.chart.visible);ol.control.Control.call(this,{element:b,target:a.target})};ol.inherits(showTideControl,ol.control.Control);
var clockControl=function(a){a=a||{};var b=document.createElement("canvas");b.id="clock";b.width=b.height=268;var c=document.createElement("div");c.className="clock ol-unselectable ol-control";c.appendChild(b);ol.control.Control.call(this,{element:c,target:a.target})};ol.inherits(clockControl,ol.control.Control);var showClockControl=function(a){a=a||{};var b=newOpenCloseWidget("Hide clock","Show clock","clock","show-clock",app.clock.visible);ol.control.Control.call(this,{element:b,target:a.target})};
ol.inherits(showClockControl,ol.control.Control);var locationControl=function(a){a=a||{};var b=document.createElement("div");b.className="location ol-unselectable ol-control";b.id="location";b.title="Current location (tap to see forecast)";b.innerHTML=convertDMS(a.coords);ol.control.Control.call(this,{element:b,target:a.target})};ol.inherits(locationControl,ol.control.Control);
function enableShutdown(){var a=new XMLHttpRequest;a.onreadystatechange=function(){4===a.readyState&&200===a.status&&JSON.parse(a.responseText)&&(document.getElementById("shutdown").style.visibility="visible")};a.open("GET","shutdown/supported");a.send()}
var getDeviceOrientation=function(){if(!navigator.userAgent.match(/mobile/i)||navigator.platform.match(/ipad/i))return"default";var a=document.getElementById("tideChart");if(!a)return"default";a=a.parentElement;switch(window.orientation){case 90:case -90:return a.style.width="60%","landscape";default:return a.style.width="80%","portrait"}},handleDeviceOrientation=function(){app.clock.positioned=0;repositionWidgets()};
function repositionWidgets(){app.clock.reposition&&clearInterval(app.clock.reposition);app.clock.reposition=setInterval(positionClock,200)}
function positionClock(){if(10<=++app.clock.positioned)app.clock.reposition&&(clearInterval(app.clock.reposition),app.clock.reposition=null);else{var a=getDeviceOrientation(),b=document.getElementById("tideChart").parentElement,c=b.getBoundingClientRect(),d=document.getElementById("clock");b=d.parentElement;var e=".5em";switch(a){case "landscape":d.width=d.height=c.height;b.style.top=c.top+"px";b.style.left=c.left-c.height-1+"px";e=window.innerWidth-c.left+1;a=c.top;break;case "portrait":e=0;default:d.width=
d.height=c.width,b.style.top=c.bottom+4+"px",b.style.left=c.left+"px",a=c.bottom+4}b.style.width=b.style.height=d.height+"px";b=document.getElementById("show-clock").parentElement;b.style.top=a+"px";b.style.right=e+"px";startClock();positionLocation()}}function positionLocation(){var a=document.getElementById("tideChart").parentElement,b=a.getBoundingClientRect();a=document.getElementById("location");a.style.left=b.left+"px";a.style.width=b.width+"px"}
function dateHelper(a){return Math.floor(a/10).toString()+a%10}function formatDateTimeUTC(a){var b=a.getUTCMonth()+1,c=a.getUTCDate(),d=a.getUTCHours(),e=a.getUTCMinutes();return a.getUTCFullYear().toString()+Math.floor(b/10)+b%10+ +Math.floor(c/10)+c%10+" "+Math.floor(d/10)+Math.floor(d%10)+":"+Math.floor(e/10)+e%10}
function formatRequestRange(a,b){a.setTime(a.getTime()-432E5);var c=formatDateTimeUTC(a);a.setTime(a.getTime()+864E5);a=formatDateTimeUTC(a);return"&begin_date="+c+"&end_date="+a+"&time_zone=GMT&station="+b+"&units=english&format=json"}
function updateWaterLevel(a){function b(a,b){function c(a){a=a.split(/[- :]/);a=new Date(a[0],a[1]-1,a[2],a[3],a[4]);a.setTime(a.getTime()-app.tzOffset);a.toString().split(" ");var b=a.getMonth()+1+"/"+a.getDate()+" "+dateHelper(a.getHours())+":"+dateHelper(a.getMinutes());return[a,b]}b=b.currentTarget;if(4===b.readyState&&200===b.status){var d=JSON.parse(b.responseText).predictions;b=[];var e=[{data:[],borderColor:"blue",borderWidth:2,backgroundColor:"rgba(0,65,135,.3)",pointBorderColor:"black",
pointBackgroundColor:"orange",pointRadius:Array(d.length).fill(0)}],f=e[0].data,g=new Date;g.setTime(g.getTime()+6E4*g.getTimezoneOffset()-app.tzOffset+864E5*app.tide.offset);for(var l=0,h=0;h<d.length;++h){b.push(d[h].t);f[h]=d[h].v;var r=c(d[h].t);0===l&&r[0].getTime()>=g.getTime()&&(l=h)}f=99999;var p=l;for(g=l;g<d.length;++g)if(h=parseFloat(d[g].v),h<f&&(p=g,f=h),h>f)if(p===l)f=h;else break;var q=l;f=-99999;for(g=l;g<d.length;++g)if(h=parseFloat(d[g].v),h>f&&(q=g,f=h),h<f)if(q===l)f=h;else break;
e[0].pointRadius[l]=6;d=document.getElementById("tideChart");app.tide.chart.line?app.tide.chart.line.destroy():swipedetect(d,function(a){if("right"===a)--app.tide.offset;else if("left"===a)++app.tide.offset;else return;app.tide.chart.lastUpdated.setTime(0);updateWaterLevel(app.map._location._coord)});app.tide.chart.line=new Chart.Line(d,{data:{labels:b,datasets:e},options:{animation:{duration:0,onComplete:function(){var a=this.chart.ctx,b=a.fillStyle,c=a.font;a.fillStyle="navy";a.textBaseline="middle";
a.textAlign="left";a.font="bold 18px calibri";for(var d=this.getDatasetMeta(0),e=0;e!=d.data.length;++e)if(!(6>d.data[e]._model.radius)){a.fillText(Math.ceil(10*this.data.datasets[0].data[e])/10+"'",35,25);break}a.fillStyle=b;a.font=c}},legend:{display:!1},title:{display:!0,fontSize:12,padding:0,position:"bottom",text:a},tooltips:{callbacks:{title:function(a,b){return c(b.labels[a[0].index])[1]}}},scales:{yAxes:[{gridLines:{color:"lightblue",borderDash:app.tide.offset?[8,4]:[0,0]}}],xAxes:[{gridLines:{color:"blue",
borderDash:app.tide.offset?[8,4]:[0,0]},ticks:{fontSize:12,maxRotation:0,autoSkip:!1},afterBuildTicks:function(a){var b=a.ticks;a.ticks=[];a.ticks[0]=["",c(b[0])[1]];a.ticks[l]=["",c(b[l])[1]];a.ticks[b.length-1]=["",c(b[b.length-1])[1]];a.ticks[p]=c(b[p])[1].split(" ")[1];a.ticks[q]=c(b[q])[1].split(" ")[1]}}]}}})}}var c=new XMLHttpRequest;c.onreadystatechange=function(a){a=a.currentTarget;if(4===a.readyState)if(200===a.status){a=JSON.parse(a.responseText);var c=new Date;if(!(app.tide.station&&a.Id===
app.tide.station.Id&&c.getTime()<app.tide.chart.lastUpdated.getTime()+3E5)){app.tide.station=a;app.tide.chart.lastUpdated=c;app.tzOffset=-a.tzOffset;c.setTime(c.getTime()+864E5*app.tide.offset);a="Station: "+a.Id+" "+a.Name+" "+a.State;var d=c.toISOString();c="?noaa"==location.search?"https://tidesandcurrents.noaa.gov/api/datagetter?product=predictions&datum=MLLW"+formatRequestRange(c,app.tide.station.Id):"tides/"+app.tide.station.Id+"/"+d;d=new XMLHttpRequest;d.onreadystatechange=b.bind(null,a);
d.open("GET",c);d.send()}}else console.log(a.response.text)};c.open("GET","nearestWaterLevelStation/"+a[1]+"/"+a[0]);c.send()}function updateCurrents(a){var b=new XMLHttpRequest;b.onreadystatechange=processCurrentsStation;b.open("GET","nearestCurrentsStation/"+a[1]+"/"+a[0]);b.send()}
function processCurrentsStation(a){a=a.currentTarget;if(4===a.readyState&&200===a.status){console.log(a.responseText);var b=JSON.parse(a.responseText);b="https://tidesandcurrents.noaa.gov/api/datagetter?product=currents"+formatRequestRange(new Date,b.Id);a.onreadystatechange=processCurrents;a.open("GET",b);a.send()}}function processCurrents(a){a=a.currentTarget;4===a.readyState&&200===a.status&&console.log(a.responseText)}
function showPopup(){if(popup.visible&&!popup.shown){var a=function(a){b();a?(app.destination.place=popup.place,app.map.setDestination()):app.map.removeDestination();geolocation.start()},b=function(){$(c).popover("destroy");popup.visible=popup.shown=!1};popup.shown=!0;var c=popup.getElement();$(c).popover("show");app.setDestination||(app.setDestination=a);a=document.getElementById("close-popup");a.onclick=b;a.ontouchstart=b;navigator.userAgent.match(/mobile/i)&&(app.hide_clock(),app.hide_tideChart())}}
function getForecast(a,b,c){c||(c=app.tzOffset);var d=document.getElementById("map"),e=Math.min(window.innerWidth,window.innerHeight)/20,k=(new Spinner({length:e,radius:e})).spin(d);forecast(a,b,function(d,e){k.stop();e=d?d.message:formatForecast(e,a,b,c);alertify.alert(e);if(!d&&!isFullScreen()&&(d=document.getElementById("alertify-ok"))){e="http://marine.weather.gov/MapClick.php?lat="+b+"&lon="+a;var f=document.createElement("a");f.target="_blank";f.href=e;f.innerHTML="Marine Weather";f.className=
"alertify-button alertify-button-ok";d.parentElement.appendChild(f)}if(d=document.getElementById("forecast"))d.style.height=.6*window.innerHeight+"px"})}
function updatePopup(a,b,c){popup.place=b;popup.coord=c;var d="<b>"+b.name+"</b>";b.state&&(d+=", "+b.state);d+="<br>"+convertDMS(c);b=3440*getDistanceFromLonLat(c,app.map._currentLocation._coord);d+="<br>"+Math.floor(100*b)/100+" nautical miles from your current location";d=app.isDestination(a)?d+'<hr><a class="btn btn-primary btn-xs" onClick="app.cancelCourse()">Cancel Course</a>  ':d+'<hr><a class="btn btn-primary btn-xs" onClick="app.setCourse()">Set Course</a>  ';d+='<button class="btn btn-primary btn-xs" onClick="getForecast('+
c[0]+","+c[1]+')">NOAA Forecast</button>';c=popup.getElement();$(c).popover({animation:!1,html:!0,placement:"top",content:d,title:'<a href="#" id="close-popup" class="close">&times;</a>'});popup.setPosition(a);popup.shown=!1;popup.visible=!0}
function searchLocation(a,b){function c(a){var b='<b>Nearest Matches</b><br><select id="searchResults" class="search-results">';for(var c=0;c<a.length;++c){var d=a[c];b+='<option value="['+d.lon+","+d.lat+']">';b+=d.name;d.stateName&&(b+=", "+d.stateName);d.state&&(b+=" ("+d.state+")");b+="</option>"}return b+"</select>"}if(!isSearching){isSearching=!0;a="search/"+a+"/"+b[0]+"/"+b[1];var d=new XMLHttpRequest;d.onreadystatechange=function(){if(4===d.readyState&&200===d.status){var a=JSON.parse(d.responseText);
if(a&&a.length){var b=c(a);alertify.confirm(b,function(b){isSearching=!1;if(b){var c=document.getElementById("searchResults");if(c){var d=JSON.parse(c.options[c.selectedIndex].value);geolocation.isTracking()&&geolocation.stop();app.map.getView().getZoom()<defaultZoom&&app.map.getView().setZoom(defaultZoom);popup.visible&&$(popup.getElement()).popover("destroy");popup.visible=popup.show=!1;var e=app.map.setInspectLocation(d)._point;app.map.animation=!0;app.map._rotateView=!1;app.map._view.animate({center:e,
rotation:2*Math.PI,zoom:defaultZoom,duration:2E3},function(){app.map.animation=!1;app.map.showInspectLocation();updatePopup(e,a[c.selectedIndex],d)})}}})}else isSearching=!1,alertify.alert("<b>No matches</b>")}};d.onerror=function(){isSearching=!1};d.open("GET",a);d.send()}}function convertDMS(a){return ol.coordinate.toStringHDMS(a)}
function updateDefault(){clearUpdateTimeout();app.map._currentLocation||(app.map.setCurrentLocation([-122.4049,47.681]),app.map.showCurrentLocation(),updateCoords())}
function initialize(){var a=[new tideChartControl,new showTideControl,new clockControl,new showClockControl,new locationControl,new trackingControl,new searchControl,new destControl,new shutdownControl];app.map=new MarineMap({controls:a,target:"map",defaultZoom:defaultZoom,onLocationUpdate:function(a){updateWaterLevel(a)},onUpdateView:function(a){}});enableShutdown();popup=new ol.Overlay({element:document.getElementById("popup")});app.map.addOverlay(popup);app.map.on("postrender",function(){showPopup();
repositionWidgets()});app.map.on("change:size",function(){app.clock.positioned=0});document.getElementById("location").addEventListener("click",function(){var a=app.map._currentLocation;if(a){var c=6E4*(new Date).getTimezoneOffset();getForecast(a._coord[0],a._coord[1],c)}});app.hide_clock()}function updateCoords(){if(elem=document.getElementById("location"))elem.innerHTML=convertDMS(app.map._currentLocation._coord)}initialize();var updateTimeout=setTimeout(updateDefault,locationTimeout);
function clearUpdateTimeout(){updateTimeout&&(clearTimeout(updateTimeout),updateTimeout=null)}
var geolocation=new GeolocationWrapper({onSuccess:function(a){a.lon&&a.lat&&(clearUpdateTimeout(),updateTracking(!0),app.map.setCurrentLocation([a.lon,a.lat]),app.map.showCurrentLocation(),app.map.updateFeatures(),updateCoords())},onError:function(a){updateTracking(!1);updateDefault()},onStop:function(){app.tide.station=null;updateTracking(!1)},onCompass:function(){if(!app.map||!app.map._updating){var a=new Date;a.getTime()<app.clock.lastUpdated.getTime()+100||(app.clock.lastUpdated=a,app.clock.visible&&
(app.clock.positioned=0,positionClock()),app.map.updateFeatures(!0))}},onNeedsCalibration:function(){alertify.alert("Compass needs calibration")},timeout:locationTimeout});startClock();swipedetect(clock.canvas,function(a){geolocation.changeSpeedUnit()},!0);geolocation.start();window.addEventListener("click",app.hideSearch,!0);window.addEventListener("touchstart",app.hideSearch,!0);window.addEventListener("orientationchange",handleDeviceOrientation);
