function WorldMagneticModel(){this.coff="  1, 0, -29438.5,      0.0,      10.7,       0.0;  1, 1,  -1501.1,   4796.2,      17.9,     -26.8;  2, 0,  -2445.3,      0.0,      -8.6,       0.0;  2, 1,   3012.5,  -2845.6,      -3.3,     -27.1;  2, 2,   1676.6,   -642.0,       2.4,     -13.3;  3, 0,   1351.1,      0.0,       3.1,       0.0;  3, 1,  -2352.3,   -115.3,      -6.2,       8.4;  3, 2,   1225.6,    245.0,      -0.4,      -0.4;  3, 3,    581.9,   -538.3,     -10.4,       2.3;  4, 0,    907.2,      0.0,      -0.4,       0.0;  4, 1,    813.7,    283.4,       0.8,      -0.6;  4, 2,    120.3,   -188.6,      -9.2,       5.3;  4, 3,   -335.0,    180.9,       4.0,       3.0;  4, 4,     70.3,   -329.5,      -4.2,      -5.3;  5, 0,   -232.6,      0.0,      -0.2,       0.0;  5, 1,    360.1,     47.4,       0.1,       0.4;  5, 2,    192.4,    196.9,      -1.4,       1.6;  5, 3,   -141.0,   -119.4,       0.0,      -1.1;  5, 4,   -157.4,     16.1,       1.3,       3.3;  5, 5,      4.3,    100.1,       3.8,       0.1;  6, 0,     69.5,      0.0,      -0.5,       0.0;  6, 1,     67.4,    -20.7,      -0.2,       0.0;  6, 2,     72.8,     33.2,      -0.6,      -2.2;  6, 3,   -129.8,     58.8,       2.4,      -0.7;  6, 4,    -29.0,    -66.5,      -1.1,       0.1;  6, 5,     13.2,      7.3,       0.3,       1.0;  6, 6,    -70.9,     62.5,       1.5,       1.3;  7, 0,     81.6,      0.0,       0.2,       0.0;  7, 1,    -76.1,    -54.1,      -0.2,       0.7;  7, 2,     -6.8,    -19.4,      -0.4,       0.5;  7, 3,     51.9,      5.6,       1.3,      -0.2;  7, 4,     15.0,     24.4,       0.2,      -0.1;  7, 5,      9.3,      3.3,      -0.4,      -0.7;  7, 6,     -2.8,    -27.5,      -0.9,       0.1;  7, 7,      6.7,     -2.3,       0.3,       0.1;  8, 0,     24.0,      0.0,       0.0,       0.0;  8, 1,      8.6,     10.2,       0.1,      -0.3;  8, 2,    -16.9,    -18.1,      -0.5,       0.3;  8, 3,     -3.2,     13.2,       0.5,       0.3;  8, 4,    -20.6,    -14.6,      -0.2,       0.6;  8, 5,     13.3,     16.2,       0.4,      -0.1;  8, 6,     11.7,      5.7,       0.2,      -0.2;  8, 7,    -16.0,     -9.1,      -0.4,       0.3;  8, 8,     -2.0,      2.2,       0.3,       0.0;  9, 0,      5.4,      0.0,       0.0,       0.0;  9, 1,      8.8,    -21.6,      -0.1,      -0.2;  9, 2,      3.1,     10.8,      -0.1,      -0.1;  9, 3,     -3.1,     11.7,       0.4,      -0.2;  9, 4,      0.6,     -6.8,      -0.5,       0.1;  9, 5,    -13.3,     -6.9,      -0.2,       0.1;  9, 6,     -0.1,      7.8,       0.1,       0.0;  9, 7,      8.7,      1.0,       0.0,      -0.2;  9, 8,     -9.1,     -3.9,      -0.2,       0.4;  9, 9,    -10.5,      8.5,      -0.1,       0.3; 10, 0,     -1.9,      0.0,       0.0,       0.0; 10, 1,     -6.5,      3.3,       0.0,       0.1; 10, 2,      0.2,     -0.3,      -0.1,      -0.1; 10, 3,      0.6,      4.6,       0.3,       0.0; 10, 4,     -0.6,      4.4,      -0.1,       0.0; 10, 5,      1.7,     -7.9,      -0.1,      -0.2; 10, 6,     -0.7,     -0.6,      -0.1,       0.1; 10, 7,      2.1,     -4.1,       0.0,      -0.1; 10, 8,      2.3,     -2.8,      -0.2,      -0.2; 10, 9,     -1.8,     -1.1,      -0.1,       0.1; 10,10,     -3.6,     -8.7,      -0.2,      -0.1; 11, 0,      3.1,      0.0,       0.0,       0.0; 11, 1,     -1.5,     -0.1,       0.0,       0.0; 11, 2,     -2.3,      2.1,      -0.1,       0.1; 11, 3,      2.1,     -0.7,       0.1,       0.0; 11, 4,     -0.9,     -1.1,       0.0,       0.1; 11, 5,      0.6,      0.7,       0.0,       0.0; 11, 6,     -0.7,     -0.2,       0.0,       0.0; 11, 7,      0.2,     -2.1,       0.0,       0.1; 11, 8,      1.7,     -1.5,       0.0,       0.0; 11, 9,     -0.2,     -2.5,       0.0,      -0.1; 11,10,      0.4,     -2.0,      -0.1,       0.0; 11,11,      3.5,     -2.3,      -0.1,      -0.1; 12, 0,     -2.0,      0.0,       0.1,       0.0; 12, 1,     -0.3,     -1.0,       0.0,       0.0; 12, 2,      0.4,      0.5,       0.0,       0.0; 12, 3,      1.3,      1.8,       0.1,      -0.1; 12, 4,     -0.9,     -2.2,      -0.1,       0.0; 12, 5,      0.9,      0.3,       0.0,       0.0; 12, 6,      0.1,      0.7,       0.1,       0.0; 12, 7,      0.5,     -0.1,       0.0,       0.0; 12, 8,     -0.4,      0.3,       0.0,       0.0; 12, 9,     -0.4,      0.2,       0.0,       0.0; 12,10,      0.2,     -0.9,       0.0,       0.0; 12,11,     -0.9,     -0.2,       0.0,       0.0; 12,12,      0.0,      0.7,       0.0,       0.0".split(";");
this.c=Array(13);this.cd=Array(13);this.tc=Array(13);this.dp=Array(13);this.k=Array(13);for(var f=0;13>f;f++)this.c[f]=Array(13),this.cd[f]=Array(13),this.tc[f]=Array(13),this.dp[f]=Array(13),this.k[f]=Array(13);this.snorm=Array(169);this.sp=Array(13);this.cp=Array(13);this.fn=Array(13);this.fm=Array(13);this.pp=Array(13);this.sp[0]=0;this.cp[0]=this.snorm[0]=this.pp[0]=1;this.dp[0][0]=0;this.c[0][0]=0;for(f=this.cd[0][0]=0;f<this.coff.length;f++){var c=this.coff[f];var e=c.split(",");c=parseInt(e[0],
10);var d=parseInt(e[1],10);var a=parseFloat(e[2]);var l=parseFloat(e[3]);var b=parseFloat(e[4]);e=parseFloat(e[5]);d<=c&&(this.c[d][c]=a,this.cd[d][c]=b,0!=d&&(this.c[c][d-1]=l,this.cd[c][d-1]=e))}for(c=this.snorm[0]=1;12>=c;c++){this.snorm[c]=this.snorm[c-1]*(2*c-1)/c;a=2;d=0;for(f=(c-d+1)/1;0<f;f--,d+=1)this.k[d][c]=((c-1)*(c-1)-d*d)/((2*c-1)*(2*c-3)),0<d&&(a=(c-d+1)*a/(c+d),this.snorm[c+13*d]=this.snorm[c+13*(d-1)]*Math.sqrt(a),a=1,this.c[c][d-1]*=this.snorm[c+13*d],this.cd[c][d-1]*=this.snorm[c+
13*d]),this.c[d][c]*=this.snorm[c+13*d],this.cd[d][c]*=this.snorm[c+13*d];this.fn[c]=c+1;this.fm[c]=c}this.k[1][1]=0;this.fm[0]=0}
WorldMagneticModel.prototype.declination=function(f,c,e,d){var a=6378.137*6378.137,l=a-4.040829998408706E7,b=a*a,t;d-=2015;if(0>d||5<d)return-999;var u=3.14159265359/180;e*=u;var g=c*u;c=Math.sin(e);var h=Math.sin(g);e=Math.cos(e);g=Math.cos(g);var m=h*h;var p=g*g;this.sp[1]=c;this.cp[1]=e;var n=Math.sqrt(a-l*m);var k=f*n;c=h/Math.sqrt((k+a)/(k+4.040829998408706E7)*((k+a)/(k+4.040829998408706E7))*p+m);e=Math.sqrt(1-c*c);r=Math.sqrt(f*f+2*k+(b-(b-0x5cd0d064e1a02)*m)/(n*n));a=Math.sqrt(a*p+4.040829998408706E7*
m);f=(f+a)/r;var w=l*g*h/(r*a);for(b=2;12>=b;b++)this.sp[b]=this.sp[1]*this.cp[b-1]+this.cp[1]*this.sp[b-1],this.cp[b]=this.cp[1]*this.cp[b-1]-this.sp[1]*this.sp[b-1];h=6371.2/r;g=h*h;m=t=k=p=0;for(a=1;12>=a;a++)for(g*=h,b=0,l=(a+b+1)/1;0<l;l--,b+=1){a==b?(this.snorm[a+13*b]=e*this.snorm[a-1+13*(b-1)],this.dp[b][a]=e*this.dp[b-1][a-1]+c*this.snorm[a-1+13*(b-1)]):1==a&&0==b?(this.snorm[a+13*b]=c*this.snorm[a-1+13*b],this.dp[b][a]=c*this.dp[b][a-1]-e*this.snorm[a-1+13*b]):1<a&&a!=b&&(b>a-2&&(this.snorm[a-
2+13*b]=0),b>a-2&&(this.dp[b][a-2]=0),this.snorm[a+13*b]=c*this.snorm[a-1+13*b]-this.k[b][a]*this.snorm[a-2+13*b],this.dp[b][a]=c*this.dp[b][a-1]-e*this.snorm[a-1+13*b]-this.k[b][a]*this.dp[b][a-2]);this.tc[b][a]=this.c[b][a]+d*this.cd[b][a];0!=b&&(this.tc[a][b-1]=this.c[a][b-1]+d*this.cd[a][b-1]);var q=g*this.snorm[a+13*b];if(0==b){var v=this.tc[b][a]*this.cp[b];n=this.tc[b][a]*this.sp[b]}else v=this.tc[b][a]*this.cp[b]+this.tc[a][b-1]*this.sp[b],n=this.tc[b][a]*this.sp[b]-this.tc[a][b-1]*this.cp[b];
t-=g*v*this.dp[b][a];k+=this.fm[b]*n*q;m+=this.fn[a]*v*q;0==e&&1==b&&(this.pp[a]=1==a?this.pp[a-1]:this.ct*this.pp[a-1]-this.k[b][a]*this.pp[a-2],q=g*this.pp[a],p+=this.fm[b]*n*q)}return Math.atan2(0==e?p:k/e,-t*f-m*w)/u};
